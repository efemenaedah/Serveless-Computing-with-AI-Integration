<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Photo Gallery - Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-family: monospace;
        }
        .test-pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.3);
        }
        .iframe-container {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
        .viewport-test {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .viewport-frame {
            border: 2px solid #6c757d;
            border-radius: 8px;
            overflow: hidden;
        }
        .viewport-label {
            background: #6c757d;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üß™ Family Photo Gallery - Integration Test Suite</h1>
            <p>Comprehensive testing for final integration and cross-browser compatibility</p>
        </div>

        <!-- Test 1: File Self-Containment -->
        <div class="test-section">
            <h2>üì¶ Test 1: File Self-Containment</h2>
            <p>Verifying that the HTML file contains no external dependencies</p>
            <button class="btn" onclick="testSelfContainment()">Run Self-Containment Test</button>
            <div id="selfContainmentResults"></div>
        </div>

        <!-- Test 2: Cross-Browser Compatibility -->
        <div class="test-section">
            <h2>üåê Test 2: Cross-Browser Compatibility</h2>
            <p>Testing modern browser features and fallbacks</p>
            <button class="btn" onclick="testBrowserCompatibility()">Run Compatibility Test</button>
            <div id="compatibilityResults"></div>
        </div>

        <!-- Test 3: Responsive Behavior -->
        <div class="test-section">
            <h2>üì± Test 3: Responsive Behavior</h2>
            <p>Testing layout adaptation across different viewport sizes</p>
            <button class="btn" onclick="testResponsiveBehavior()">Run Responsive Test</button>
            
            <div class="viewport-test">
                <div class="viewport-frame">
                    <div class="viewport-label">Mobile (320px)</div>
                    <iframe id="mobile-frame" src="index.html" style="width: 320px; height: 400px;"></iframe>
                </div>
                <div class="viewport-frame">
                    <div class="viewport-label">Tablet (768px)</div>
                    <iframe id="tablet-frame" src="index.html" style="width: 768px; height: 400px;"></iframe>
                </div>
                <div class="viewport-frame">
                    <div class="viewport-label">Desktop (1200px)</div>
                    <iframe id="desktop-frame" src="index.html" style="width: 1200px; height: 400px;"></iframe>
                </div>
            </div>
            <div id="responsiveResults"></div>
        </div>

        <!-- Test 4: Functionality Without External Dependencies -->
        <div class="test-section">
            <h2>‚öôÔ∏è Test 4: Core Functionality</h2>
            <p>Testing all functionality works without external dependencies</p>
            <button class="btn" onclick="testCoreFunctionality()">Run Functionality Test</button>
            
            <div class="iframe-container">
                <iframe id="functionality-frame" src="index.html"></iframe>
            </div>
            <div id="functionalityResults"></div>
        </div>

        <!-- Test 5: File Portability -->
        <div class="test-section">
            <h2>üìÅ Test 5: File Portability</h2>
            <p>Testing that the file works when moved to different locations</p>
            <button class="btn" onclick="testFilePortability()">Run Portability Test</button>
            <div id="portabilityResults"></div>
        </div>

        <!-- Overall Results -->
        <div class="test-section">
            <h2>üìä Overall Test Results</h2>
            <button class="btn" onclick="runAllTests()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                üöÄ Run All Tests
            </button>
            <div id="overallResults"></div>
        </div>
    </div>

    <script>
        let testResults = {};

        function logResult(testName, message, passed = true) {
            const className = passed ? 'test-pass' : 'test-fail';
            const icon = passed ? '‚úÖ' : '‚ùå';
            return `<div class="${className}">${icon} ${message}</div>`;
        }

        function logInfo(message) {
            return `<div class="test-info">‚ÑπÔ∏è ${message}</div>`;
        }

        // Test 1: Self-Containment
        function testSelfContainment() {
            const resultsDiv = document.getElementById('selfContainmentResults');
            resultsDiv.innerHTML = '<div class="test-info">üîç Analyzing HTML file for external dependencies...</div>';
            
            fetch('index.html')
                .then(response => response.text())
                .then(html => {
                    let results = '';
                    let passed = 0;
                    let total = 0;

                    // Test for external scripts
                    total++;
                    const hasExternalScripts = /<script[^>]+src=["']https?:\/\//.test(html);
                    if (!hasExternalScripts) {
                        results += logResult('External Scripts', 'No external script dependencies found');
                        passed++;
                    } else {
                        results += logResult('External Scripts', 'External script dependencies detected', false);
                    }

                    // Test for external stylesheets
                    total++;
                    const hasExternalCSS = /<link[^>]+href=["']https?:\/\//.test(html);
                    if (!hasExternalCSS) {
                        results += logResult('External CSS', 'No external stylesheet dependencies found');
                        passed++;
                    } else {
                        results += logResult('External CSS', 'External stylesheet dependencies detected', false);
                    }

                    // Test for external images (except data URLs)
                    total++;
                    const hasExternalImages = /<img[^>]+src=["']https?:\/\//.test(html);
                    if (!hasExternalImages) {
                        results += logResult('External Images', 'No external image dependencies found');
                        passed++;
                    } else {
                        results += logResult('External Images', 'External image dependencies detected', false);
                    }

                    // Test for embedded CSS and JS
                    total++;
                    const hasEmbeddedCSS = /<style[^>]*>/.test(html);
                    const hasEmbeddedJS = /<script(?![^>]*src)[^>]*>/.test(html);
                    if (hasEmbeddedCSS && hasEmbeddedJS) {
                        results += logResult('Embedded Code', 'CSS and JavaScript are properly embedded');
                        passed++;
                    } else {
                        results += logResult('Embedded Code', 'Missing embedded CSS or JavaScript', false);
                    }

                    results += logInfo(`Self-Containment Test: ${passed}/${total} checks passed`);
                    testResults.selfContainment = passed === total;
                    resultsDiv.innerHTML = results;
                })
                .catch(error => {
                    resultsDiv.innerHTML = logResult('File Access', `Error reading HTML file: ${error.message}`, false);
                    testResults.selfContainment = false;
                });
        }

        // Test 2: Browser Compatibility
        function testBrowserCompatibility() {
            const resultsDiv = document.getElementById('compatibilityResults');
            let results = '';
            let passed = 0;
            let total = 0;

            // Test CSS Grid support
            total++;
            if (CSS.supports('display', 'grid')) {
                results += logResult('CSS Grid', 'CSS Grid is supported');
                passed++;
            } else {
                results += logResult('CSS Grid', 'CSS Grid is not supported', false);
            }

            // Test Fetch API support
            total++;
            if (typeof fetch === 'function') {
                results += logResult('Fetch API', 'Fetch API is supported');
                passed++;
            } else {
                results += logResult('Fetch API', 'Fetch API is not supported', false);
            }

            // Test IntersectionObserver support
            total++;
            if ('IntersectionObserver' in window) {
                results += logResult('IntersectionObserver', 'IntersectionObserver is supported');
                passed++;
            } else {
                results += logResult('IntersectionObserver', 'IntersectionObserver is not supported', false);
            }

            // Test AbortController support
            total++;
            if ('AbortController' in window) {
                results += logResult('AbortController', 'AbortController is supported');
                passed++;
            } else {
                results += logResult('AbortController', 'AbortController is not supported', false);
            }

            // Test ES6+ features
            total++;
            try {
                eval('const test = () => {}; class TestClass {}');
                results += logResult('ES6+ Features', 'ES6+ features are supported');
                passed++;
            } catch (error) {
                results += logResult('ES6+ Features', 'ES6+ features are not supported', false);
            }

            results += logInfo(`Browser Compatibility Test: ${passed}/${total} features supported`);
            testResults.browserCompatibility = passed >= total * 0.8; // 80% threshold
            resultsDiv.innerHTML = results;
        }

        // Test 3: Responsive Behavior
        function testResponsiveBehavior() {
            const resultsDiv = document.getElementById('responsiveResults');
            let results = '';
            let passed = 0;
            let total = 3; // Number of viewport tests

            // Test each iframe for responsive behavior
            const viewports = [
                { name: 'Mobile', frame: 'mobile-frame', width: 320 },
                { name: 'Tablet', frame: 'tablet-frame', width: 768 },
                { name: 'Desktop', frame: 'desktop-frame', width: 1200 }
            ];

            viewports.forEach(viewport => {
                try {
                    const iframe = document.getElementById(viewport.frame);
                    if (iframe && iframe.contentWindow) {
                        // Check if the iframe loaded successfully
                        results += logResult(viewport.name, `${viewport.name} viewport (${viewport.width}px) loaded successfully`);
                        passed++;
                    } else {
                        results += logResult(viewport.name, `${viewport.name} viewport failed to load`, false);
                    }
                } catch (error) {
                    results += logResult(viewport.name, `${viewport.name} viewport test error: ${error.message}`, false);
                }
            });

            results += logInfo(`Responsive Behavior Test: ${passed}/${total} viewports working`);
            testResults.responsiveBehavior = passed === total;
            resultsDiv.innerHTML = results;
        }

        // Test 4: Core Functionality
        function testCoreFunctionality() {
            const resultsDiv = document.getElementById('functionalityResults');
            let results = '';
            let passed = 0;
            let total = 0;

            try {
                const iframe = document.getElementById('functionality-frame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

                // Test DOM elements
                const requiredElements = [
                    'seePhotosBtn', 'toggleArchitectureBtn', 'photoGrid', 
                    'loadingState', 'errorState', 'photoDetailModal'
                ];

                requiredElements.forEach(elementId => {
                    total++;
                    const element = iframeDoc.getElementById(elementId);
                    if (element) {
                        results += logResult('DOM Element', `Element '${elementId}' found`);
                        passed++;
                    } else {
                        results += logResult('DOM Element', `Element '${elementId}' missing`, false);
                    }
                });

                // Test CSS Grid implementation
                total++;
                const photoGrid = iframeDoc.getElementById('photoGrid');
                if (photoGrid) {
                    const computedStyle = iframe.contentWindow.getComputedStyle(photoGrid);
                    if (computedStyle.display === 'grid') {
                        results += logResult('CSS Grid', 'Photo grid uses CSS Grid layout');
                        passed++;
                    } else {
                        results += logResult('CSS Grid', 'Photo grid does not use CSS Grid layout', false);
                    }
                } else {
                    results += logResult('CSS Grid', 'Photo grid element not found', false);
                }

                // Test JavaScript functionality
                total++;
                const iframeWindow = iframe.contentWindow;
                if (typeof iframeWindow.handleSeePhotos === 'function') {
                    results += logResult('JavaScript', 'Core JavaScript functions are defined');
                    passed++;
                } else {
                    results += logResult('JavaScript', 'Core JavaScript functions are missing', false);
                }

            } catch (error) {
                results += logResult('Functionality Test', `Error accessing iframe content: ${error.message}`, false);
            }

            results += logInfo(`Core Functionality Test: ${passed}/${total} checks passed`);
            testResults.coreFunctionality = passed >= total * 0.8; // 80% threshold
            resultsDiv.innerHTML = results;
        }

        // Test 5: File Portability
        function testFilePortability() {
            const resultsDiv = document.getElementById('portabilityResults');
            let results = '';
            let passed = 0;
            let total = 0;

            // Test file access via different methods
            total++;
            fetch('index.html')
                .then(response => {
                    if (response.ok) {
                        results += logResult('HTTP Access', 'File accessible via HTTP');
                        passed++;
                    } else {
                        results += logResult('HTTP Access', 'File not accessible via HTTP', false);
                    }
                    
                    // Test file size (should be reasonable for a single file)
                    total++;
                    const contentLength = response.headers.get('content-length');
                    if (contentLength) {
                        const sizeKB = Math.round(contentLength / 1024);
                        if (sizeKB < 1000) { // Less than 1MB is reasonable
                            results += logResult('File Size', `File size is reasonable: ${sizeKB}KB`);
                            passed++;
                        } else {
                            results += logResult('File Size', `File size is large: ${sizeKB}KB`, false);
                        }
                    } else {
                        results += logResult('File Size', 'Could not determine file size', false);
                    }

                    results += logInfo(`File Portability Test: ${passed}/${total} checks passed`);
                    testResults.filePortability = passed === total;
                    resultsDiv.innerHTML = results;
                })
                .catch(error => {
                    results += logResult('File Access', `Error accessing file: ${error.message}`, false);
                    testResults.filePortability = false;
                    resultsDiv.innerHTML = results;
                });
        }

        // Run All Tests
        function runAllTests() {
            const resultsDiv = document.getElementById('overallResults');
            resultsDiv.innerHTML = '<div class="test-info">üöÄ Running comprehensive test suite...</div>';

            // Run all tests in sequence
            testSelfContainment();
            setTimeout(() => {
                testBrowserCompatibility();
                setTimeout(() => {
                    testResponsiveBehavior();
                    setTimeout(() => {
                        testCoreFunctionality();
                        setTimeout(() => {
                            testFilePortability();
                            setTimeout(() => {
                                // Generate overall results
                                generateOverallResults();
                            }, 2000);
                        }, 1000);
                    }, 1000);
                }, 1000);
            }, 2000);
        }

        function generateOverallResults() {
            const resultsDiv = document.getElementById('overallResults');
            let results = '<h3>üìä Final Test Results</h3>';
            
            const tests = [
                { name: 'Self-Containment', key: 'selfContainment' },
                { name: 'Browser Compatibility', key: 'browserCompatibility' },
                { name: 'Responsive Behavior', key: 'responsiveBehavior' },
                { name: 'Core Functionality', key: 'coreFunctionality' },
                { name: 'File Portability', key: 'filePortability' }
            ];

            let passedTests = 0;
            tests.forEach(test => {
                const passed = testResults[test.key];
                if (passed !== undefined) {
                    results += logResult(test.name, `${test.name} Test`, passed);
                    if (passed) passedTests++;
                } else {
                    results += logResult(test.name, `${test.name} Test - Not Run`, false);
                }
            });

            const overallPassed = passedTests === tests.length;
            results += `<div style="margin-top: 20px; padding: 20px; border-radius: 8px; ${overallPassed ? 'background: #d4edda; color: #155724;' : 'background: #f8d7da; color: #721c24;'}">`;
            results += `<h4>${overallPassed ? 'üéâ ALL TESTS PASSED!' : '‚ö†Ô∏è SOME TESTS FAILED'}</h4>`;
            results += `<p>Overall Result: ${passedTests}/${tests.length} tests passed</p>`;
            
            if (overallPassed) {
                results += '<p><strong>‚úÖ The Family Photo Gallery is ready for production deployment!</strong></p>';
                results += '<ul>';
                results += '<li>‚úÖ File is completely self-contained with no external dependencies</li>';
                results += '<li>‚úÖ Cross-browser compatibility verified</li>';
                results += '<li>‚úÖ Responsive design works across all viewport sizes</li>';
                results += '<li>‚úÖ Core functionality operates without external services</li>';
                results += '<li>‚úÖ File is portable and can be moved to any location</li>';
                results += '</ul>';
            } else {
                results += '<p><strong>‚ùå Please address the failing tests before deployment.</strong></p>';
            }
            results += '</div>';

            resultsDiv.innerHTML = results;
        }

        // Auto-run basic tests on page load
        window.addEventListener('load', () => {
            console.log('Integration test page loaded');
            // Auto-run responsive test to show the iframes
            setTimeout(() => {
                testResponsiveBehavior();
            }, 1000);
        });
    </script>
</body>
</html>